@model Amba.ImagePowerTools.ViewModels.ImageMultiPickerFieldEditorViewModel
@using (Script.Head())
{    
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.5/angular.min.js" type="text/javascript"></script>
    <script src="https://raw.github.com/angular-ui/angular-ui/master/build/angular-ui.min.js" type="text/javascript"></script>
    <script src="/Modules/Amba.ImagePowerTools/Scripts/MultipickerDashboard.js"  type="text/javascript"></script>
    <script src="/Modules/Amba.ImagePowerTools/Scripts/ExtraEvents.js"  type="text/javascript"></script>
    <link href="/Modules/Amba.ImagePowerTools/Styles/dashboard.css" type="text/css" rel="stylesheet"/>  
}
@{
    Script.Require("jQueryUI_Sortable").AtHead();
    var pickerId = Guid.NewGuid().ToString("N").Substring(0, 6);
}
<fieldset>
    <label>@Model.Field.DisplayName</label>
    <div id="app_@(pickerId)">
        <div data-ng-controller="DashboardCtrl">
        
            <div class="imagemultipicker-dashboard-button-panel">
                <a class="button" data-ng-click="selectImages()">@T("Select Images")</a>
                <a class="button" data-ng-click="reset()">@T("Reset")</a>
                <a class="button" data-ng-click="clear()">@T("Clear")</a>
            </div>

            <input name="@Html.NameFor(x => x.Data)" type="hidden" value="{{data|json}}"/>  
            <div
                data-ee-dragenter="onDragEnter($event)"
                data-ee-dragover="onDragOver($event)"
                data-ee-dragleave="onDragLeave($event)"
                data-ee-drop="onDrop($event)"
                >      
                <ul class="table image-list" ng-model="data" ui:sortable>
                    <li class="table-row image-item" data-ng-repeat="image in data" >
                        <div class="table-cell image-preview" style="width:100px;">
                            <img ng-src="/ipt/resize{{image.file}}?width=100" alt="" style="width:100px;"/>
                        </div>
                        <div class="table-cell image-fields">
                            <span class="filepath">{{image.file | filename}}</span>
                            <textarea data-ng-model="image.descr" rows="1"></textarea>
                        </div>
                        <div class="table-cell image-buttons">
                            <a href="" ng-click="deleteImage(image.file)">@T("Delete")</a>
                        </div>
                    </li>
                    <li data-ng-show="data.length==0 && uploads.length==0" class="empty-list table-row">
                        <div class="upload-message table-cell">@T("Drop file here to upload")</div>
                    </li>
                </ul>
                <ul class="upload-list table" data-ng-show="uploads.length > 0">
                    <li class="table-row upload-item" data-ng-repeat="upload in uploads" >
                        <div class="table-cell upload-progress">
                            {{upload.progress}}%
                        </div>
                        <div class="table-cell upload-file">
                            {{upload.file}}
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</fieldset>

@using(Script.Foot())
{
    <script type="text/javascript">
        angular.module('app_@(pickerId)', ['MultipickerDashboard', 'ExtraEvents', 'ui'])
            .value('data', @Html.Raw(Model.Data))
            .value('options', {
                id: '@(pickerId)',
                fieldFolder: '@Html.Raw(Model.FieldFolderName)'
            });
            
        angular.bootstrap($('#app_@(pickerId)'), ['app_@(pickerId)']);
    </script>
}